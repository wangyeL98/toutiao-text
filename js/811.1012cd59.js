"use strict";(self["webpackChunktoutiao_mob"]=self["webpackChunktoutiao_mob"]||[]).push([[811],{7811:function(t,e,o){o.r(e),o.d(e,{default:function(){return c}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-box"},[e("van-nav-bar",{attrs:{title:"登录"}},[e("van-icon",{attrs:{slot:"left",name:"cross"},on:{click:function(e){return t.$router.back()}},slot:"left"})],1),e("van-form",{ref:"loginForm",on:{submit:t.onSubmit}},[e("van-field",{attrs:{placeholder:"请输入手机号",name:"mobile",rules:t.test.mobile,type:"number",maxlength:"11"},model:{value:t.user.mobile,callback:function(e){t.$set(t.user,"mobile",e)},expression:"user.mobile"}},[e("i",{staticClass:"toutiao toutiao-shouji",attrs:{slot:"left-icon"},slot:"left-icon"})]),e("van-field",{attrs:{placeholder:"请输入验证码",name:"code",rules:t.test.code,type:"number",maxlength:"6"},scopedSlots:t._u([{key:"button",fn:function(){return[t.isShow?e("van-count-down",{attrs:{time:5e3,format:"ss s"},on:{finish:function(e){t.isShow=!1}}}):e("van-button",{staticClass:"login-yzms",attrs:{size:"small",type:"default",round:"","native-type":"button"},on:{click:t.checkCode}},[t._v("发送验证码")])]},proxy:!0}]),model:{value:t.user.code,callback:function(e){t.$set(t.user,"code",e)},expression:"user.code"}},[e("i",{staticClass:"toutiao toutiao-yanzhengma",attrs:{slot:"left-icon"},slot:"left-icon"})]),e("div",{staticClass:"login-btn"},[e("van-button",{attrs:{block:"",type:"info","native-type":"submit"}},[t._v("登录")])],1)],1)],1)},n=[],i=o(2900),r={name:"LoginIndex",data(){return{user:{mobile:"",code:""},test:{mobile:[{required:!0,message:"手机号不能为空"},{pattern:/^1[3|5|7|8]\d{9}$/,message:"手机号格式错误"}],code:[{required:!0,message:"验证码不能为空"},{pattern:/^\d{6}$/,message:"验证码格式错误"}]},isShow:!1}},methods:{async onSubmit(){const t=this.user;this.$toast.loading({message:"加载中...",forbidClick:!0,duration:0});try{const e=await(0,i.x4)(t);this.$toast.success("登录成功"),this.$store.commit("setUser",e.data.data),this.$router.back()}catch(e){400===e.response.status?(console.log("登录失败",e),this.$toast.fail("登录失败")):(this.$toast.fail("登录失败"),console.log("登录事变,请稍后重试",e))}},async checkCode(){try{await this.$refs.loginForm.validate("mobile")}catch(t){return console.log("发送失败",t)}this.isShow=!0;try{const t=await(0,i.lW)(this.user.mobile);this.$toast("发送成功"),console.log(t)}catch(t){this.isShow=!1,429===t.response.status?this.$toast("发送频繁，请稍后重试"):this.$toast("发送错误，请稍后重试")}}}},a=r,l=o(1001),u=(0,l.Z)(a,s,n,!1,null,null,null),c=u.exports},2900:function(t,e,o){o.d(e,{N2:function(){return m},Yu:function(){return r},bG:function(){return h},ei:function(){return l},it:function(){return f},j8:function(){return u},lW:function(){return i},oK:function(){return a},qB:function(){return d},t5:function(){return c},vV:function(){return v},x4:function(){return n}});var s=o(435);const n=t=>(0,s.Z)({url:"/v1_0/authorizations",method:"POST",data:t}),i=t=>(0,s.Z)({url:`/v1_0/sms/codes/${t}`,method:"GET"}),r=()=>(0,s.Z)({url:"/v1_0/user",method:"GET"}),a=t=>(0,s.Z)({url:"/v1_0/user/followings",method:"POSt",data:{target:t}}),l=t=>(0,s.Z)({url:`/v1_0/user/followings/${t}`,method:"DELETE"}),u=t=>(0,s.Z)({url:"/v1_0/article/collections",method:"POST",data:{target:t}}),c=t=>(0,s.Z)({url:`/v1_0/article/collections/${t}`,method:"DELETE"}),d=t=>(0,s.Z)({url:"/v1_0/article/likings",method:"POST",data:{target:t}}),m=t=>(0,s.Z)({url:`/v1_0/article/likings/${t}`,method:"DELETE"}),h=()=>(0,s.Z)({url:"/v1_0/user/profile",method:"GET"}),f=t=>(0,s.Z)({url:"/v1_0/user/profile",method:"PATCH",data:t}),v=t=>(0,s.Z)({url:"/v1_0/user/photo",method:"PATCH",data:t})}}]);
//# sourceMappingURL=811.1012cd59.js.map
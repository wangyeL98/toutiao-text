"use strict";(self["webpackChunktoutiao_mob"]=self["webpackChunktoutiao_mob"]||[]).push([[991],{4991:function(t,s,a){a.r(s),a.d(s,{default:function(){return q}});var e=function(){var t=this,s=t._self._c;return s("div",{staticClass:"home_contain"},[s("van-nav-bar",{staticClass:"home_title",attrs:{fixed:""}},[s("van-button",{staticClass:"search_btn",attrs:{slot:"title",type:"info",round:"",size:"small",icon:"search",to:"/search"},slot:"title"},[t._v(" 搜索 ")])],1),s("van-tabs",{staticClass:"list_box",attrs:{animated:"",swipeable:""},model:{value:t.active,callback:function(s){t.active=s},expression:"active"}},[t._l(t.channelList,(function(t){return s("van-tab",{key:t.id,staticClass:"text1",attrs:{title:t.name}},[s("Article",{attrs:{obj:t}})],1)})),s("div",{staticClass:"more",attrs:{slot:"nav-right"},on:{click:function(s){t.show=!0}},slot:"nav-right"},[s("i",{staticClass:"toutiao toutiao-gengduo"})]),s("div",{staticClass:"mask",attrs:{slot:"nav-right"},slot:"nav-right"})],2),s("van-popup",{style:{height:"100%"},attrs:{closeable:"",round:"","close-icon-position":"top-left",position:"bottom"},model:{value:t.show,callback:function(s){t.show=s},expression:"show"}},[s("channel-list",{attrs:{MychannelList:t.channelList,active:t.active},on:{addchannel:t.addchannelfn,changed:t.changedfn,remove:t.del}})],1)],1)},i=[],n=(a(7658),function(){var t=this,s=t._self._c;return s("div",{staticClass:"channel-box"},[s("van-cell",{attrs:{center:""}},[s("div",{staticClass:"title",attrs:{slot:"title"},slot:"title"},[t._v("我的频道")]),s("van-button",{staticClass:"change-btn",attrs:{slot:"default",size:"mini",round:"",plain:""},on:{click:t.taggle},slot:"default"},[t._v(t._s(t.isShow?"完成":"编辑"))])],1),s("van-grid",{attrs:{gutter:10}},t._l(t.MychannelList,(function(a,e){return s("van-grid-item",{key:e,staticClass:"grid-item",on:{click:function(s){return t.changed(e,a)}}},[s("span",{staticClass:"text",class:{highlight:t.active===e},attrs:{slot:"text"},slot:"text"},[t._v(t._s(a.name))]),t.isShow&&!t.check.includes(a.id)?s("van-icon",{staticClass:"close",attrs:{slot:"icon",name:"close"},slot:"icon"}):t._e()],1)})),1),s("van-cell",{staticClass:"recommend_top",attrs:{center:""}},[s("div",{staticClass:"title",attrs:{slot:"title"},slot:"title"},[t._v("频道推荐")])]),s("van-grid",{attrs:{gutter:10}},t._l(t.recommendList,(function(a,e){return s("van-grid-item",{key:e,staticClass:"grid-item grid-item-recommend",on:{click:function(s){return t.addList(a)}}},[s("span",{attrs:{slot:"text"},slot:"text"},[t._v(t._s(a.name)+" ")]),s("van-icon",{attrs:{slot:"icon",name:"plus"},slot:"icon"})],1)})),1)],1)}),l=[],c=a(435);const o=()=>(0,c.Z)({url:"/v1_0/channels",method:"GET"});var r={name:"ChannelIndex",props:{MychannelList:{type:Array,required:!0},active:{type:Number,required:!0}},data(){return{AllChannelList:[],isShow:!1,check:[0]}},methods:{taggle(){this.isShow=!this.isShow},addList(t){this.$emit("addchannel",t)},changed(t,s){this.isShow?this.$emit("remove",t,this.active,s.id,this.check):this.$emit("changed",t)}},async created(){const{data:t}=await o();this.AllChannelList=t.data.channels},computed:{recommendList(){return this.AllChannelList.filter((t=>!this.MychannelList.find((s=>s.id===t.id))))}}},h=r,d=a(1001),u=(0,d.Z)(h,n,l,!1,null,null,null),v=u.exports;const m=()=>(0,c.Z)({url:"/v1_0/user/channels",method:"GET"}),g=t=>(0,c.Z)({url:"/v1_0/user/channels",method:"PATCH",data:{channels:[t]}}),f=t=>(0,c.Z)({url:`/v1_0/user/channels/${t}`,method:"DELETE"});var p=function(){var t=this,s=t._self._c;return s("div",{staticClass:"article_box"},[s("van-pull-refresh",{attrs:{"success-text":t.msg,"success-duration":1500},on:{refresh:t.onRefresh},model:{value:t.isLoading,callback:function(s){t.isLoading=s},expression:"isLoading"}},[s("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(s){t.error=s},load:t.onLoad},model:{value:t.loading,callback:function(s){t.loading=s},expression:"loading"}},[s("Article",{attrs:{arr:t.list}})],1)],1)],1)},_=[],C=(a(541),function(){var t=this,s=t._self._c;return s("div",{staticClass:"article-item"},t._l(t.arr,(function(a,e){return s("van-cell",{key:e,attrs:{to:"/article/"+a.art_id}},[s("div",{staticClass:"title van-multi-ellipsis--l2",attrs:{slot:"title"},slot:"title"},[t._v(t._s(a.title))]),3===a.cover.type?s("div",{staticClass:"imgs",attrs:{slot:"label"},slot:"label"},t._l(a.cover.images,(function(t,a){return s("div",{key:a,staticClass:"imgs-item"},[s("van-image",{staticClass:"van-item-imgs",attrs:{fit:"cover",src:t}})],1)})),0):t._e(),s("div",{staticClass:"desc",attrs:{slot:"label"},slot:"label"},[s("span",[t._v(t._s(a.aut_name))]),s("span",[t._v(t._s(a.comm_count)+"评论")]),s("span",[t._v(t._s(t._f("dealtime")(a.pubdate)))])]),1===a.cover.type?s("div",{staticClass:"right",attrs:{slot:"default"},slot:"default"},[s("van-image",{staticClass:"right-img",attrs:{fit:"cover",src:a.cover.images[0]}})],1):t._e()])})),1)}),L=[],b={name:"ArticleIndex",props:["arr"],created(){}},y=b,x=(0,d.Z)(y,C,L,!1,null,null,null),w=x.exports;const k=t=>(0,c.Z)({url:"/v1_0/articles",method:"GET",params:t});var A={name:"ArticleIndex",components:{Article:w},props:{obj:{type:Object,required:!0}},data(){return{list:[],loading:!1,finished:!1,timer:null,error:!1,isLoading:!1,msg:"刷新成功"}},methods:{async onRefresh(){try{const{data:t}=await k({channel_id:this.obj.id,timestamp:Date.now()}),{results:s}=t.data;this.list.unshift(...s),this.isLoading=!1}catch(t){this.msg("刷新失败")}},async onLoad(){try{const{data:t}=await k({channel_id:this.obj.id,timestamp:this.timer||Date.now()}),{results:s}=t.data;this.list.push(...s),this.loading=!1,s.length?this.timer=Date.parse(s.pubdate):this.finished=!0}catch(t){this.error=!0,this.loading=!1}}}},E=A,Z=(0,d.Z)(E,p,_,!1,null,null,null),S=Z.exports,M=a(3822),N=a(7247),j={components:{Article:S,ChannelList:v},computed:{...(0,M.rn)(["user"])},created(){this.loading()},name:"HomeIndex",data(){return{active:0,channelList:[],show:!1}},methods:{async loading(){let t=[];if(this.user){const s=await m();t=s.data.data.channels}else{const s=(0,N.rV)("MYCHANNEL");if(s)t=s;else{const s=await m();t=s.data.data.channels}}this.channelList=t},async addchannelfn(t){if(this.channelList.push(t),this.user)try{await g({id:t.id,seq:this.channelList.length})}catch(s){console.log(s)}else(0,N.LS)("MYCHANNEL",this.channelList)},changedfn(t){this.active=t,this.show=!1},async del(t,s,a,e){if(!e.includes(a))if(t<=s&&(this.active=s-1),this.channelList.splice(t,1),this.user)try{await f(a)}catch(i){console.log(i)}else(0,N.LS)("MYCHANNEL",this.channelList)}}},H=j,T=(0,d.Z)(H,e,i,!1,null,null,null),q=T.exports}}]);
//# sourceMappingURL=991.dc4e2ac0.js.map